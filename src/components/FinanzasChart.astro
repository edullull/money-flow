<div class="blog-card" style="padding: 1.5rem; height: 100%;">
    <h3 style="margin: 0 0 1rem 0; font-size: 1rem; color: #1e293b; text-align: center;">Distribución de Gastos</h3>
    <div style="position: relative; height: 250px; width: 100%;">
      <canvas id="financeChart"></canvas>
    </div>
  </div>
  
  <script>
    import Chart from 'chart.js/auto';
  
    let myChart: any = null;
  
    // Usamos (window as any) para que TypeScript no de error al asignar la función
    (window as any).renderFinanceChart = (movimientos: any[]) => {
      const ctx = document.getElementById('financeChart') as HTMLCanvasElement;
      if (!ctx) return;
  
      // Filtramos solo los gastos para la gráfica
      const gastos = movimientos.filter(m => m.tipo === 'gasto');
  
      const totalesPorCategoria: { [key: string]: number } = {};
      gastos.forEach(g => {
        totalesPorCategoria[g.categoria] = (totalesPorCategoria[g.categoria] || 0) + parseFloat(g.monto);
      });
  
      const labels = Object.keys(totalesPorCategoria);
      const dataValues = Object.values(totalesPorCategoria);
  
      if (myChart) {
        myChart.destroy();
      }
  
      myChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: labels,
          datasets: [{
            data: dataValues,
            backgroundColor: ['#3b82f6', '#ef4444', '#f59e0b', '#10b981', '#8b5cf6', '#64748b'],
            borderWidth: 2,
            borderColor: '#ffffff'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { position: 'bottom', labels: { usePointStyle: true, font: { size: 11 } } }
          },
          cutout: '70%'
        }
      });
    };
  </script>